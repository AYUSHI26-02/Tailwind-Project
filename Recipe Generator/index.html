<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Global Recipe Explorer</title>
  <link rel="stylesheet" href="../output.css">
</head>
<body class="bg-white text-gray-900">
  <div class="max-w-5xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-4 text-center">Explore Recipes from Around the World</h1>

    <!-- Country Dropdown -->
    <div class="flex items-center gap-2 mb-4">
      <select id="countrySelect" onchange="fetchRecipesByCountry()" 
              class="p-3 border border-gray-600 rounded w-full">
        <option value="">üåç Select Country</option>
      </select>
    </div>

    <!-- Search Bar -->
    <div class="flex items-center gap-0 mb-6">
      <input id="searchInput" type="text" placeholder="Search Recipes" 
             class="w-full p-3 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500"/>
      <button onclick="searchRecipes()" 
              class="bg-cyan-400 border border-gray-600 text-white px-4 py-3 rounded-r hover:bg-cyan-800 transition">
        üîç
      </button>
    </div>

    <!-- Results -->
    <p id="resultCount" class="mb-4 font-medium text-gray-700"></p>
    <div id="results" class="space-y-6"></div>
  </div>

  <script>
    // Load country list on page load
    window.onload = async function () {
      try {
        const res = await fetch('https://www.themealdb.com/api/json/v1/1/list.php?a=list');
        const data = await res.json();
        const select = document.getElementById("countrySelect");

        data.meals.forEach(area => {
          const option = document.createElement("option");
          option.value = area.strArea;
          option.textContent = area.strArea;
          select.appendChild(option);
        });
      } catch (err) {
        console.error("Failed to load countries", err);
      }
    };

    // Search by meal name
    async function searchRecipes() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      const resultsDiv = document.getElementById("results");
      const resultCount = document.getElementById("resultCount");

      resultsDiv.innerHTML = "";
      resultCount.textContent = "";

      if (!query) return;

      try {
        const res = await fetch(`https://www.themealdb.com/api/json/v1/1/search.php?s=${query}`);
        const data = await res.json();

        if (!data.meals) {
          resultsDiv.innerHTML = `<p class="text-red-500">No recipes found.</p>`;
          return;
        }

        const meals = data.meals;

        const uniqueMeals = Array.from(new Set(meals.map(meal => meal.idMeal)))
          .map(id => meals.find(meal => meal.idMeal === id));

        resultCount.textContent = `Recipes found: ${uniqueMeals.length}`;

        uniqueMeals.forEach(meal => {
          const shortInstructions = meal.strInstructions.split(" ").slice(0, 25).join(" ");
          const fullInstructions = meal.strInstructions;

          // Placeholder nutritional information
          const nutrition = {
            protein: `${Math.floor(Math.random() * 30)}g`,
            fat: `${Math.floor(Math.random() * 20)}g`,
            carbs: `${Math.floor(Math.random() * 100)}g`,
            cholesterol: `${Math.floor(Math.random() * 50)}mg`,
            sodium: `${Math.floor(Math.random() * 500)}mg`,
            calcium: `${Math.floor(Math.random() * 100)}mg`,
            servings: "4",
            calories: `${Math.floor(Math.random() * 500)} kcal`
          };

          const card = document.createElement("div");
          card.className = "border rounded-md p-4 shadow-sm flex flex-col md:flex-row gap-4";

          card.innerHTML = `
            <img src="${meal.strMealThumb}" alt="${meal.strMeal}" class="w-full md:w-48 h-48 object-cover rounded-md">
            <div class="flex-1">
              <h2 class="text-xl font-bold mb-2">${meal.strMeal}</h2>
              <p class="text-sm text-gray-700"><strong>Instructions:</strong> 
                <span class="short">${shortInstructions}...</span>
                <span class="full hidden">${fullInstructions}</span>
                <button class="text-green-600 ml-2 toggleMore hover:underline">more</button>
              </p>
              <div class="mt-3 flex gap-6 flex-wrap text-sm">
                <div><span class="text-green-600 font-bold">PROTEIN</span><br>${nutrition.protein}</div>
                <div><span class="text-pink-600 font-bold">FAT</span><br>${nutrition.fat}</div>
                <div><span class="text-red-500 font-bold">CARB</span><br>${nutrition.carbs}</div>
                <div><strong>Sodium</strong><br>${nutrition.sodium}</div>
                <div><strong>Calcium</strong><br>${nutrition.calcium}</div>
              </div>
              <p class="mt-2 text-sm text-gray-600">${nutrition.servings} servings ¬∑ <span class="font-bold">${nutrition.calories}</span></p>
            </div>
          `;

          resultsDiv.appendChild(card);
        });

        document.querySelectorAll(".toggleMore").forEach(button => {
          button.addEventListener("click", () => {
            const shortText = button.parentElement.querySelector(".short");
            const fullText = button.parentElement.querySelector(".full");
            const isHidden = fullText.classList.contains("hidden");
            if (isHidden) {
              shortText.classList.add("hidden");
              fullText.classList.remove("hidden");
              button.textContent = "less";
            } else {
              shortText.classList.remove("hidden");
              fullText.classList.add("hidden");
              button.textContent = "more";
            }
          });
        });

      } catch (err) {
        console.error(err);
        resultsDiv.innerHTML = `<p class="text-red-500">Something went wrong. Please try again later.</p>`;
      }
    }

    // Fetch recipes by country
    async function fetchRecipesByCountry() {
      const area = document.getElementById("countrySelect").value;
      const resultsDiv = document.getElementById("results");
      const resultCount = document.getElementById("resultCount");

      resultsDiv.innerHTML = "";
      resultCount.textContent = "";

      if (!area) return;

      try {
        const res = await fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?a=${area}`);
        const data = await res.json();

        if (!data.meals) {
          resultsDiv.innerHTML = `<p class="text-red-500">No recipes found for ${area}.</p>`;
          return;
        }

        resultCount.textContent = `Recipes from ${area}: ${data.meals.length}`;

        for (let meal of data.meals) {
          const card = document.createElement("div");
          card.className = "border rounded-md p-4 shadow-sm flex gap-4 items-center";

          card.innerHTML = `
            <img src="${meal.strMealThumb}" alt="${meal.strMeal}" class="w-32 h-32 object-cover rounded">
            <h2 class="text-lg font-semibold">${meal.strMeal}</h2>
          `;

          resultsDiv.appendChild(card);
        }
      } catch (err) {
        console.error(err);
        resultsDiv.innerHTML = `<p class="text-red-500">Error fetching recipes.</p>`;
      }
    }
  </script>
</body>
</html>